// Generated by CoffeeScript 1.3.1
(function() {
  var find_templates, summarize, templates;

  (function() {
    var cache, tmpl;
    cache = {};
    return tmpl = this.tmpl = function(str, data) {
      var fn;
      fn = new Function("obj", "var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('" + str.replace(/[\r\t\n]/g, " ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g, "$1\r").replace(/\t=(.*?)%>/g, "',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'") + "');}return p.join('');");
      if (data) {
        return fn(data);
      } else {
        return fn;
      }
    };
  })();

  find_templates = function(elements) {
    var results;
    results = {};
    $(elements).each(function() {
      var el;
      el = $(this);
      return results[el.attr('id')] = tmpl(el.html());
    });
    return results;
  };

  templates = {};

  $(function() {
    return window.templates = templates = find_templates('script[type="text/template"]');
  });

  summarize = function(elements, max_length) {
    return $(elements).each(function() {
      var el;
      el = $(this);
      if (el.text().length > max_length + 53) {
        el.data('full-text', el.text());
        el.text(el.text().substring(0, max_length) + '... ');
        el.append('<a href="#read-more" class="read-more">more</a>');
        return el.find('.read-more').click(function() {
          el.text(el.data('full-text'));
          return $(window).trigger('summary-expanded', [el, el.text()]);
        });
      }
    });
  };

  $(function() {
    return summarize('.summarize', 250);
  });

  $(function() {
    var elements, resized;
    elements = null;
    resized = function() {
      var children, cutoff, width;
      width = $(window).width();
      cutoff = 992;
      if (elements != null) {
        elements.masonry('destroy');
        elements = null;
      }
      if (width >= cutoff) {
        elements = $('.events');
        children = elements.find('.event');
        return elements.masonry({
          itemSelector: '.event',
          columnWidth: children.width() + parseInt(children.css('padding-left'), 10) + parseInt(children.css('padding-right'), 10)
        });
      }
    };
    $(window).bind('resize', resized);
    $(window).bind('summary-expanded', resized);
    return resized();
  });

}).call(this);
